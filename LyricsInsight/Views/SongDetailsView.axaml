<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:LyricsInsight.ViewModels"
             xmlns:asyncImageLoader="clr-namespace:AsyncImageLoader;assembly=AsyncImageLoader.Avalonia"
             xmlns:md="clr-namespace:Markdown.Avalonia;assembly=Markdown.Avalonia"
             xmlns:progressRing="clr-namespace:AvaloniaProgressRing;assembly=AvaloniaProgressRing"
             xmlns:ctxt="clr-namespace:ColorTextBlock.Avalonia;assembly=ColorTextBlock.Avalonia"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="LyricsInsight.Views.SongDetailsView"
             x:DataType="vm:SongDetailsViewModel">
    
    <Grid ColumnDefinitions="400, *" Margin="0, 20, 0, 0">
        
        <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">
            <StackPanel Spacing="10" Margin="20">
                
                <Button Command="{Binding BackCommand}"
                        HorizontalAlignment="Left" Margin="0,0,0,10" 
                        Background="Transparent" CornerRadius="20"
                        BorderBrush="Gray" BorderThickness="1">
                    ← Назад
                </Button>
                
                <Border CornerRadius="20" ClipToBounds="True"
                        HorizontalAlignment="Center"
                        Width="270" Height="270">
                    <Image asyncImageLoader:ImageLoader.Source="{Binding CoverUrlBig}"
                           Stretch="UniformToFill"/>
                </Border>
                
                <StackPanel Spacing="2" HorizontalAlignment="Center" Margin="0,10,0,0">
                    <Button Content="{Binding TrackTitle}"
                            Command="{Binding OpenLinkCommand}"
                            CommandParameter="{Binding TrackLink}"
                            FontSize="24" FontWeight="Bold"
                            HorizontalAlignment="Center" 
                            Background="Transparent"
                            BorderThickness="0"/>
                    
                    <Button Content="{Binding FormattedTrackArtists}"
                            Command="{Binding OpenLinkCommand}"
                            CommandParameter="{Binding ArtistLink}"
                            FontSize="18" Opacity="0.8"
                            HorizontalAlignment="Center" 
                            Background="Transparent"
                            BorderThickness="0"/>
            
                    <Button Content="{Binding AlbumTitle}"
                            Command="{Binding OpenLinkCommand}"
                            CommandParameter="{Binding AlbumLink}"
                            FontSize="14" Opacity="0.6"
                            HorizontalAlignment="Center" 
                            Background="Transparent"
                            BorderThickness="0"/>
                </StackPanel>
                
                <progressRing:ProgressRing IsVisible="{Binding IsLoadingDetails}"
                              
                              Width="50" Height="50"
                              HorizontalAlignment="Center" Margin="0,20"/>
                
                <StackPanel IsVisible="{Binding !IsLoadingDetails}"
                            Spacing="5" Margin="0,15,0,0">
                    
                    <Expander Header="Детайли за песента" HorizontalAlignment="Stretch" Background="Transparent">
                        <StackPanel Spacing="2">
                            <TextBlock Text="{Binding FormattedTrackReleaseDate}"/>
                            <TextBlock Text="{Binding FormattedTrackDuration}"/>
                            <TextBlock Text="{Binding FormattedTrackRank}"/>
                            <TextBlock Text="{Binding FormattedTrackPosition}"/>
                            <TextBlock Text="{Binding FormattedTrackDiskNumber}"/>
                            <TextBlock Text="{Binding FormattedBpm}"/>
                        </StackPanel>
                    </Expander>
                    
                    <Expander Header="Детайли за албума" HorizontalAlignment="Stretch" Background="Transparent">
                        <StackPanel Spacing="2">
                            <TextBlock Text="{Binding FormattedAlbumGenres}" TextWrapping="Wrap"/>
                            <TextBlock Text="{Binding FormattedRecordType}"/>
                            <TextBlock Text="{Binding FormattedAlbumDuration}"/>
                            <TextBlock Text="{Binding FormattedAlbumLabel}" TextWrapping="Wrap"/>
                            <TextBlock Text="{Binding FormattedAlbumFans}"/>
                        </StackPanel>
                    </Expander>

                    <Expander Header="Детайли за изпълнителя" HorizontalAlignment="Stretch" Background="Transparent">
                        <StackPanel Spacing="2">
                            <Border CornerRadius="10" ClipToBounds="True" 
                                    Width="200" Height="200" Margin="0,10"
                                    HorizontalAlignment="Left">
                                <Image asyncImageLoader:ImageLoader.Source="{Binding ArtistPicture}" 
                                       Stretch="UniformToFill"/>
                            </Border>
                            <TextBlock Text="{Binding ArtistName}"/>
                            <TextBlock Text="{Binding ArtistNbAlbum}"/>
                            <TextBlock Text="{Binding ArtistNbFan}"/>
                        </StackPanel>
                    </Expander>
                    
                </StackPanel>
                
                <Separator Margin="0,15"/>
                <Label Margin="0,5,0,0">Изтегляне:</Label>
                
                <Grid ColumnDefinitions="*,*,*">
                    <Button Grid.Column="0" Content="Корица (.jpg)" HorizontalAlignment="Stretch">
                        <Button.Flyout>
                            <MenuFlyout>
                                <MenuItem Header="Малка" x:Name="SaveCoverSmall"/>
                                <MenuItem Header="Средна" x:Name="SaveCoverMedium"/>
                                <MenuItem Header="Голяма" x:Name="SaveCoverBig"/>
                                <MenuItem Header="XL" x:Name="SaveCoverXl"/>
                            </MenuFlyout>
                        </Button.Flyout>
                    </Button>
                    
                    <Button Grid.Column="1" Content="Текст (.txt)"
                            x:Name="SaveLyricsButton"
                            IsEnabled="{Binding !IsLoadingLyrics}"
                            HorizontalAlignment="Stretch"/>
                    
                    <Button Grid.Column="2" Content="Анализ (.pdf)"
                            x:Name="SaveAnalysisButton"
                            IsEnabled="{Binding IsAnalysisReady}"
                            HorizontalAlignment="Stretch"/>
                </Grid>
                
            </StackPanel>
        </ScrollViewer>
        
        <TabControl Grid.Column="1">
            <TabItem Header="Текст">
                <Grid>
                    <progressRing:ProgressRing IsActive="{Binding IsLoadingLyrics}"
                                 
                                 Width="100" Height="100"
                                 HorizontalAlignment="Center"
                                 VerticalAlignment="Center"/>
                    
                    <TextBox IsVisible="{Binding !IsLoadingLyrics}" 
                             Text="{Binding LyricsText}"
                             IsReadOnly="True" AcceptsReturn="True" TextWrapping="Wrap"
                             ScrollViewer.VerticalScrollBarVisibility="Auto" Margin="10"
                             BorderThickness="0" FontSize="20" TextAlignment="Center"/>
                </Grid>
            </TabItem>
            
            <TabItem Header="AI Анализ">
                <Grid>
                    <progressRing:ProgressRing IsActive="{Binding IsLoadingAnalysis}"
                                 
                                 Width="100" Height="100"
                                 HorizontalAlignment="Center"
                                 VerticalAlignment="Center"/>
                    
                    <md:MarkdownScrollViewer IsVisible="{Binding !IsLoadingAnalysis}"
                                             Markdown="{Binding AiAnalysisText}"
                                             Margin="10">
                        <md:MarkdownScrollViewer.Styles>
                            <Style Selector="ctxt|CTextBlock">
                                <Setter Property="FontSize" Value="20"></Setter>
                            </Style>
                        </md:MarkdownScrollViewer.Styles>
                    </md:MarkdownScrollViewer>
                </Grid>
            </TabItem>
            
        </TabControl>
    </Grid>
</UserControl>